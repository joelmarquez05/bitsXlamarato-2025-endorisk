# Instruccions per a l'Agent d'IA - Projecte NEST

## Resum del Projecte
**Nom:** NEST (NSMP Endometrial Stratification Tool)
**Objectiu:** Predir la **probabilitat de recaiguda** en pacients amb C√†ncer d'Endometri NSMP.
**Usuaris finals:** Onc√≤legs Ginecol√≤gics.

## Producte Final
Aplicaci√≥ Streamlit amb:
1. **Login** - Autenticaci√≥ del doctor
2. **Formulari** - Entrada de dades del pacient
3. **Resultat** amb 3 panells:
   - Predicci√≥ (probabilitat + sem√†for üü¢üü°üî¥)
   - Interpretabilitat (gr√†fic d'import√†ncia de features)
   - Explicaci√≥ IA (Gemini API)

## Coneixement M√®dic Cr√≠tic
- **NSMP** = 50% dels casos, grup "calaix de sastre"
- **Prioritzem Sensibilitat (Recall)** - Un Fals Negatiu √©s fatal
- Divisi√≥ en: Baix, Mitj√† i Alt Risc

## Stack T√®cnic
- Python 3.11 / Streamlit / Scikit-learn / Pandas / Joblib
- Google Gemini API (explicacions)
- Docker & Docker Compose

## Estructura de Fitxers
```
‚îú‚îÄ‚îÄ data/raw/           # Dades originals
‚îú‚îÄ‚îÄ data/processed/     # Dades netes
‚îú‚îÄ‚îÄ notebooks/          # 01‚Üí02‚Üí03‚Üí04 en ordre
‚îú‚îÄ‚îÄ models/             # Models entrenats (.joblib)
‚îú‚îÄ‚îÄ app/                # Streamlit app
‚îî‚îÄ‚îÄ src/                # M√≤duls reutilitzables
```

---

## Regles Obligat√≤ries per a l'IA

### 1. Notebooks (.ipynb)
**MAI editis un fitxer `.ipynb` directament.**
Nom√©s proporciona el codi perqu√® l'usuari el copi√Ø.

### 2. Comentaris
- **Minimitza els comentaris** - Nom√©s quan sigui estrictament necessari
- **Tots els comentaris en CATAL√Ä**
- Exemple:
```python
# Carreguem el model entrenat
model = joblib.load('models/model.joblib')

# Fem la predicci√≥
prob = model.predict_proba(X)[0][1]
```

### 3. Idioma del Codi
| Element | Idioma |
|---------|--------|
| Variables i funcions | Angl√®s |
| Comentaris | Catal√† |
| UI Strings | Castell√†/Catal√† |

### 4. Convencions de Naming

#### Variables
```python
# ‚úÖ Correcte: snake_case, descriptiu, angl√®s
patient_age = 65
tumor_grade = 3
myometrial_invasion = 0.6
has_lvsi = True
recurrence_probability = 0.78

# ‚ùå Incorrecte
edad = 65           # Castell√†
tg = 3              # Massa curt
myometrialInvasion  # camelCase
```

#### Funcions
```python
# ‚úÖ Correcte: snake_case, verb + noun
def load_patient_data(filepath):
    pass

def calculate_recurrence_risk(features):
    pass

def preprocess_clinical_features(df):
    pass

# ‚ùå Incorrecte
def calcularRiesgo():    # Castell√† + camelCase
def data():              # Massa gen√®ric
def process():           # Qu√® processa?
```

#### Classes
```python
# ‚úÖ Correcte: PascalCase
class PatientData:
    pass

class RecurrencePredictor:
    pass

class FeatureEncoder:
    pass
```

#### Constants
```python
# ‚úÖ Correcte: SCREAMING_SNAKE_CASE
TARGET_COLUMN = 'recurrence'
RISK_THRESHOLDS = {'low': 0.3, 'medium': 0.6, 'high': 0.8}
MODEL_PATH = 'models/model.joblib'
GEMINI_MODEL = 'gemini-pro'
```

#### Fitxers
| Tipus | Format | Exemple |
|-------|--------|---------|
| Notebooks | `##_descriptive_name.ipynb` | `03_model_training.ipynb` |
| M√≤duls Python | `snake_case.py` | `feature_engineering.py` |
| Models | `model_name.joblib` | `random_forest_v2.joblib` |
| Dades | `descriptive_name.csv` | `features_train.csv` |

#### Prefixos i Sufixos Est√†ndard
| Prefix/Sufix | Significat | Exemple |
|--------------|------------|---------|
| `X_`, `y_` | Features / Target | `X_train`, `y_test` |
| `_df` | DataFrame | `patients_df` |
| `_path` | Ruta de fitxer | `model_path` |
| `_config` | Configuraci√≥ | `app_config` |
| `is_`, `has_` | Booleans | `is_valid`, `has_lvsi` |
| `n_`, `num_` | Comptadors | `n_samples`, `num_features` |
| `_scaled` | Dades normalitzades | `X_scaled` |
| `_encoded` | Dades codificades | `stage_encoded` |

### 5. Estil de Codi
- Segueix PEP 8
- Codi net i llegible
- M√†xim 88 car√†cters per l√≠nia
- Evita codi redundant

### 6. Convencions de Fitxers

#### Imports (ordre)
```python
# 1. Standard library
import os
from pathlib import Path

# 2. Third-party
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestClassifier

# 3. Local
from src.preprocessing import clean_data
```

#### Estructura d'un m√≤dul
```python
"""
Descripci√≥ breu del m√≤dul (en angl√®s).
"""
# Imports
import pandas as pd

# Constants
TARGET_COLUMN = 'recurrence'

# Funcions auxiliars (privades amb _)
def _validate_input(df):
    pass

# Funcions p√∫bliques
def load_data(path):
    pass

# Classes
class DataProcessor:
    pass
```

### 7. Vocabulari del Domini (Terminologia M√®dica)

Utilitza sempre aquests termes en angl√®s per consist√®ncia:

| Catal√†/Castell√† | Angl√®s (usar sempre) |
|-----------------|---------------------|
| Recaiguda/Reca√≠da | `recurrence` |
| Grau tumoral | `tumor_grade` |
| Invasi√≥ miometrial | `myometrial_invasion` |
| Estadi | `stage` |
| LVSI | `lvsi` (ja √©s acr√≤nim angl√®s) |
| Pacient | `patient` |
| Predicci√≥ | `prediction` |
| Probabilitat | `probability` |
| Risc | `risk` |
| Alt/Mitj√†/Baix | `high`, `medium`, `low` |
